<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìƒì‚´ë¡± ë¦¬ë·° ë©”ì´ì»¤</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fade-in-down { 0% { opacity: 0; transform: translate(-50%, -20px); } 100% { opacity: 1; transform: translate(-50%, 0); } }
        @keyframes fade-in { 0% { opacity: 0; transform: translateY(10px); } 100% { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-down { animation: fade-in-down 0.3s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ë¸Œë¼ìš°ì €ìš© ì„¤ì •
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        function App() {
            const [activeTab, setActiveTab] = useState('generate');
            const [inputText, setInputText] = useState('');
            const [loading, setLoading] = useState(false);
            const [currentResult, setCurrentResult] = useState(null);
            const [history, setHistory] = useState([]);
            const [error, setError] = useState(null);
            const [toastMessage, setToastMessage] = useState(null);
            const [expandedCategories, setExpandedCategories] = useState({});
            const [expandedItems, setExpandedItems] = useState({});

            useEffect(() => {
                const savedHistory = localStorage.getItem('tripcom_reviews_history');
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            useEffect(() => {
                localStorage.setItem('tripcom_reviews_history', JSON.stringify(history));
                if (window.lucide) lucide.createIcons();
            }, [history, activeTab, currentResult]);

            const showToast = (msg) => {
                setToastMessage(msg);
                setTimeout(() => setToastMessage(null), 2500);
            };

            const parseInput = (text) => {
                let count = 1;
                let place = text.trim();
                const match = place.match(/ã…(\d+)$/);
                if (match) {
                    count = parseInt(match[1], 10);
                    place = place.replace(/ã…\d+$/, '').trim();
                } else if (place.endsWith('ã…')) {
                    place = place.replace(/ã…$/, '').trim();
                }
                return { place, count };
            };

            const callGeminiAPI = async (place, count) => {
                const apiKey = "AIzaSyAqXbxMdcprEQaHLhdEmwMSKw3ZMjSFOMM"; 
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

                const systemPrompt = `ë‹¹ì‹ ì€ íŠ¸ë¦½ë‹·ì»´ì˜ ì „ë¬¸ ë¦¬ë·° ì‘ì„±ê°€ì´ì ì§€ë¦¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì¥ì†Œì— ëŒ€í•´ ì•„ë˜ ê·œì¹™ì„ ë”°ë¼ ì§€ì—­ì„ ë¶„ë¥˜í•˜ê³  ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ê°œë¥¼ ìš”ì²­ë°›ì„ ê²½ìš°, ê° ë¦¬ë·°ëŠ” ì‹œì , ë¶„ìœ„ê¸°, ê°•ì¡° í¬ì¸íŠ¸ê°€ ì™„ì „íˆ ë‹¤ë¥¸ ë²„ì „ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. [ë¶„ë¥˜ ê·œì¹™] ì…ë ¥ëœ ì¥ì†Œë¥¼ íŒŒì•…í•˜ì—¬ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ì¹´í…Œê³ ë¦¬ë¡œ ì •í™•íˆ ë¶„ë¥˜í•˜ì„¸ìš”: "ì„œìš¸", "ê²½ê¸°ë„", "ê°•ì›ë„", "ì¶©ì²­ë„", "ì „ë¼ë„", "ê²½ìƒë„", "ì œì£¼ë„", "ê¸°íƒ€"(í•´ì™¸ ë˜ëŠ” ë¶ˆë¶„ëª…). [ì‘ì„± ê·œì¹™] 1. ì œëª©: ì•ë¶€ë¶„ì— ì´ëª¨ì§€ë¥¼ 1ê°œ ë„£ìœ¼ì„¸ìš”. ëª…ì‚¬í˜•ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ëë‚´ì„¸ìš”. 2. ë³¸ë¬¸: ê¸€ììˆ˜ 400~500ì ë‚´ì™¸. 3. íŒ: ë¬¸ë‹¨ì„ ë„ìš°ê³  ì‹¤ìš©ì ì¸ ê¿€íŒ 2~3ê°œ ìš”ì•½. [ğŸš« ì ˆëŒ€ ê¸ˆì§€] ì˜¤ê¸€ê±°ë¦¬ëŠ” ë©˜íŠ¸, í•œê¸€(ì˜ì–´) ë³‘ê¸°, ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸, ë°˜ì  ë‚¨ë°œ, ì„œìˆ í˜• ì œëª©, ì œëª©ì— ì¥ì†Œëª… ê¸°ì….`;
                const userPrompt = `ì¥ì†Œ: ${place}\nì‘ì„± ê°œìˆ˜: ${count}ê°œ\nê·œì¹™ì— ë§ì¶° JSONìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.`;

                const payload = {
                    contents: [{ parts: [{ text: userPrompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                category: { type: "STRING" },
                                reviews: {
                                    type: "ARRAY",
                                    items: {
                                        type: "OBJECT",
                                        properties: {
                                            title: { type: "STRING" },
                                            body: { type: "STRING" },
                                            tips: { type: "ARRAY", items: { type: "STRING" } }
                                        },
                                        required: ["title", "body", "tips"]
                                    }
                                }
                            },
                            required: ["category", "reviews"]
                        }
                    }
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            };

            const handleGenerate = async (e) => {
                e.preventDefault();
                if (!inputText.trim()) return;
                setLoading(true); setError(null);
                const { place, count } = parseInput(inputText);
                try {
                    const resultData = await callGeminiAPI(place, count);
                    const newItem = {
                        id: Date.now().toString(),
                        place,
                        category: resultData.category || 'ê¸°íƒ€',
                        date: new Date().toLocaleString(),
                        reviews: resultData.reviews
                    };
                    setCurrentResult(newItem);
                    setHistory(prev => [newItem, ...prev]);
                    setInputText('');
                } catch (err) {
                    setError("ë¦¬ë·° ìƒì„± ì‹¤íŒ¨. API ì„¤ì •ì´ë‚˜ ëª¨ë¸ ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.");
                } finally { setLoading(false); }
            };

            const copyToClipboard = (review) => {
                const text = `${review.title}\n\n${review.body}\n\nğŸ’«íŒ\n${review.tips.map(t => `Â· ${t}`).join('\n')}`;
                navigator.clipboard.writeText(text).then(() => showToast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
            };

            const groupedHistory = history.reduce((acc, item) => {
                const cat = item.category || 'ê¸°íƒ€';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {});

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-8">
                    {toastMessage && <div className="fixed top-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full z-50 animate-fade-in-down">{toastMessage}</div>}
                    
                    <div className="flex space-x-2 bg-gray-200 p-1.5 rounded-2xl w-fit mx-auto mb-8">
                        <button onClick={() => setActiveTab('generate')} className={`px-6 py-2 rounded-xl font-medium ${activeTab==='generate' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>ë¦¬ë·° ìƒì„±</button>
                        <button onClick={() => setActiveTab('history')} className={`px-6 py-2 rounded-xl font-medium ${activeTab==='history' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>ê¸°ë¡ ({history.length})</button>
                    </div>

                    {activeTab === 'generate' ? (
                        <div className="animate-fade-in">
                            <div className="bg-white p-8 rounded-2xl shadow-sm border mb-6">
                                <h1 className="text-2xl font-bold mb-4">âœˆï¸ íŠ¸ë¦½ë‹·ì»´ ë¦¬ë·° ì‘ì„±</h1>
                                <form onSubmit={handleGenerate} className="relative">
                                    <input type="text" value={inputText} onChange={e=>setInputText(e.target.value)} placeholder="ì˜ˆ: êµ¬ë¡€ í™”ì—„ì‚¬ ã…2" className="w-full p-4 pr-16 rounded-xl border-2 outline-none focus:border-blue-500 text-lg" />
                                    <button type="submit" className="absolute right-2 top-2 bottom-2 px-4 bg-blue-600 text-white rounded-lg flex items-center">{loading ? <Icon name="refresh-cw" className="animate-spin" /> : <Icon name="send" />}</button>
                                </form>
                            </div>
                            {currentResult && currentResult.reviews.map((r, i) => (
                                <div key={i} className="bg-white p-6 rounded-2xl border mb-4 relative">
                                    <button onClick={() => copyToClipboard(r)} className="absolute top-6 right-6 p-2 bg-gray-100 rounded-lg hover:bg-gray-200"><Icon name="copy" /></button>
                                    <h2 className="text-xl font-bold mb-4 pr-12">{r.title}</h2>
                                    <p className="text-gray-700 mb-6 leading-relaxed">{r.body}</p>
                                    <div className="bg-gray-50 p-4 rounded-xl border"><strong>ğŸ’«íŒ</strong><ul className="mt-2">{r.tips.map((t, idx) => <li key={idx} className="text-gray-600">Â· {t}</li>)}</ul></div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="bg-white p-8 rounded-2xl border animate-fade-in">
                            {Object.keys(groupedHistory).length === 0 ? <p className="text-center text-gray-400">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p> : 
                                Object.keys(groupedHistory).map(cat => (
                                    <div key={cat} className="mb-4">
                                        <div className="font-bold text-lg mb-2 p-3 bg-gray-50 rounded-lg">{cat} ({groupedHistory[cat].length})</div>
                                        {groupedHistory[cat].map(item => (
                                            <div key={item.id} className="ml-4 p-2 border-l-2 mb-2">
                                                <div className="font-medium">{item.place}</div>
                                                <div className="text-xs text-gray-400">{item.date}</div>
                                            </div>
                                        ))}
                                    </div>
                                ))
                            }
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
