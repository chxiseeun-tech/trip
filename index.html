<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŠ¸ë¦½ë‹·ì»´ ë¦¬ë·° ì‘ì„±ê¸°</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì•„ì´ì½˜ì„ ìœ„í•œ ì»´í¬ë„ŒíŠ¸
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        function App() {
            const [activeTab, setActiveTab] = useState('generate');
            const [inputText, setInputText] = useState('');
            const [loading, setLoading] = useState(false);
            const [currentResult, setCurrentResult] = useState(null);
            const [history, setHistory] = useState([]);
            const [error, setError] = useState(null);
            const [toastMessage, setToastMessage] = useState(null);

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            useEffect(() => {
                const saved = localStorage.getItem('tripcom_reviews_history');
                if (saved) setHistory(JSON.parse(saved));
            }, []);

            // ê¸°ë¡ ì €ì¥í•˜ê¸°
            useEffect(() => {
                localStorage.setItem('tripcom_reviews_history', JSON.stringify(history));
                if (window.lucide) lucide.createIcons();
            }, [history, activeTab]);

            const showToast = (msg) => {
                setToastMessage(msg);
                setTimeout(() => setToastMessage(null), 2500);
            };

            const parseInput = (text) => {
                let count = 1;
                let place = text.trim();
                const match = place.match(/ã…(\d+)$/);
                if (match) {
                    count = parseInt(match[1], 10);
                    place = place.replace(/ã…\d+$/, '').trim();
                }
                return { place, count };
            };

            const callGeminiAPI = async (place, count) => {
                const apiKey = "AIzaSyAqXbxMdcprEQaHLhdEmwMSKw3ZMjSFOMM"; 
                // ì—ëŸ¬ê°€ ë‚¬ë˜ ì£¼ì†Œë¥¼ ì •ìƒì ì¸ 1.5-flash ëª¨ë¸ë¡œ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

                const systemPrompt = `ë‹¹ì‹ ì€ íŠ¸ë¦½ë‹·ì»´ì˜ ì „ë¬¸ ë¦¬ë·° ì‘ì„±ê°€ì…ë‹ˆë‹¤. ê·œì¹™: 1. ì œëª© ì• ì´ëª¨ì§€ 2. ë³¸ë¬¸ 400~500ì 3. ğŸ’«íŒ í¬í•¨ ğŸš«ê¸ˆì§€: ì˜¤ê¸€ê±°ë¦¬ëŠ” ë©˜íŠ¸, í•œê¸€(ì˜ì–´) ë³‘ê¸°, ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸, ì œëª©ì— ì¥ì†Œëª… ê¸°ì…. ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì£¼ì„¸ìš”.`;
                const userPrompt = `ì¥ì†Œ: ${place}, ê°œìˆ˜: ${count}ê°œ. ì§€ì—­ ë¶„ë¥˜(ì„œìš¸, ê²½ê¸°ë„ ë“±)ì™€ ë¦¬ë·°ë¥¼ ìƒì„±í•´ì¤˜.`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if (!response.ok) throw new Error("API í˜¸ì¶œ ì‹¤íŒ¨");
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            };

            const handleGenerate = async (e) => {
                e.preventDefault();
                setLoading(true); setError(null);
                const { place, count } = parseInput(inputText);
                try {
                    const resultData = await callGeminiAPI(place, count);
                    const newItem = {
                        id: Date.now().toString(),
                        place,
                        category: resultData.category || 'ê¸°íƒ€',
                        date: new Date().toLocaleString(),
                        reviews: resultData.reviews
                    };
                    setCurrentResult(newItem);
                    setHistory(prev => [newItem, ...prev]);
                    setInputText('');
                } catch (err) {
                    setError("ë¦¬ë·° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                } finally { setLoading(false); }
            };

            const copyToClipboard = (review) => {
                const text = `${review.title}\n\n${review.body}\n\nğŸ’«íŒ\n${review.tips.map(t => `Â· ${t}`).join('\n')}`;
                navigator.clipboard.writeText(text).then(() => showToast("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
            };

            return (
                <div className="max-w-3xl mx-auto p-4 md:p-8">
                    {toastMessage && <div className="fixed top-4 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full z-50">{toastMessage}</div>}
                    
                    <div className="flex space-x-2 bg-gray-200 p-1.5 rounded-2xl w-fit mx-auto mb-8">
                        <button onClick={() => setActiveTab('generate')} className={`px-6 py-2 rounded-xl font-medium ${activeTab==='generate' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>ë¦¬ë·° ìƒì„±</button>
                        <button onClick={() => setActiveTab('history')} className={`px-6 py-2 rounded-xl font-medium ${activeTab==='history' ? 'bg-white text-blue-600 shadow' : 'text-gray-500'}`}>ê¸°ë¡ ({history.length})</button>
                    </div>

                    {activeTab === 'generate' ? (
                        <div className="space-y-6">
                            <div className="bg-white p-8 rounded-2xl shadow-sm border">
                                <h1 className="text-2xl font-bold mb-4">âœˆï¸ íŠ¸ë¦½ë‹·ì»´ ë¦¬ë·° ì‘ì„±</h1>
                                <form onSubmit={handleGenerate} className="relative">
                                    <input type="text" value={inputText} onChange={e=>setInputText(e.target.value)} placeholder="ì˜ˆ: ì—¬ìˆ˜ ë¼í…Œë¼ìŠ¤ ã…2" className="w-full p-4 pr-16 rounded-xl border-2 outline-none focus:border-blue-500 text-lg" />
                                    <button type="submit" className="absolute right-2 top-2 bottom-2 px-4 bg-blue-600 text-white rounded-lg flex items-center">{loading ? <Icon name="refresh-cw" className="animate-spin" /> : <Icon name="send" />}</button>
                                </form>
                            </div>
                            {currentResult && currentResult.reviews.map((r, i) => (
                                <div key={i} className="bg-white p-6 rounded-2xl border mb-4 relative shadow-sm">
                                    <button onClick={() => copyToClipboard(r)} className="absolute top-6 right-6 p-2 bg-gray-100 rounded-lg"><Icon name="copy" /></button>
                                    <h2 className="text-xl font-bold mb-4 pr-12">{r.title}</h2>
                                    <p className="text-gray-700 mb-6 leading-relaxed whitespace-pre-wrap">{r.body}</p>
                                    <div className="bg-gray-50 p-4 rounded-xl border"><strong>ğŸ’«íŒ</strong><ul className="mt-2">{r.tips.map((t, idx) => <li key={idx}>Â· {t}</li>)}</ul></div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {history.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-xl border flex justify-between items-center">
                                    <div>
                                        <div className="font-bold">{item.place} <span className="text-sm font-normal text-blue-500">({item.category})</span></div>
                                        <div className="text-xs text-gray-400">{item.date}</div>
                                    </div>
                                    <button onClick={() => { setHistory(history.filter(h => h.id !== item.id)); showToast("ì‚­ì œë¨"); }} className="p-2 text-gray-300 hover:text-red-500"><Icon name="trash-2" /></button>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
